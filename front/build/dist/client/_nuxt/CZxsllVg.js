import{f as M,g as N,r as l,h as S,i as A,j as B,c as n,k as p,t as E,a as t,l as f,v as y,m as R,d as D,o as c}from"./t96BDbEU.js";const W=t("h1",{class:"text-center text-2xl mt-2"},"Аутентифікація",-1),j={key:0,class:"text-center mt-1 mb-2"},C={key:1,class:"text-red-500 text-center mt-1 mb-2"},L={key:2,class:"mt-1 mb-2 text-green-500 text-center"},$={key:3,class:"mt-4"},q=t("h2",{class:"text-center text-xl mb-2"},[D(" Але дані Вашого профілю неповні. "),t("br"),D("Додайте інформації про себе, щоб користуватись платформою. ")],-1),z={class:"mb-2"},F=t("label",{for:"name",class:"block"},"Ім'я:",-1),G={class:"mb-2"},H=t("label",{for:"surname",class:"block"},"Прізвище:",-1),I={class:"mb-2"},J=t("label",{for:"phone",class:"block"},"Телефон:",-1),K={class:"mb-2"},O=t("label",{for:"picture",class:"block"},"Фото профілю (URL):",-1),P=t("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded mt-2"}," Зберегти ",-1),Q={key:4,class:"text-center"},X=t("a",{href:"/"},"Повернутися на головну",-1),Y=[X],te={__name:"[uuid]",setup(Z){const k=M(),{$api:w}=N(),g=l(!1),m=l(!1),d=S(),U=l(!0),T=A(),a=l(null),v=l(""),h=l(""),_=l(""),x=l("");B(async()=>{var r,s,e,i;try{const u=T.params.uuid,b=await w.auth.getAuthUser(u);if(b&&[200,201].includes(b.status)&&![400,401,403,404,500].includes(b.data.status)){const o=b.data;k.saveUserData(o),m.value=!0,!o.user.name||!o.user.surname||!o.user.phone?(v.value=o.user.name||"",h.value=o.user.surname||"",_.value=o.user.phone||"",x.value=o.user.picture||"",g.value=!0):setTimeout(()=>d.push("/"),2e3)}else a.value="Помилка запиту.",setTimeout(()=>d.push("/"),3e3)}catch(u){a.value="Помилка запиту: "+((s=(r=u.response)==null?void 0:r.data)!=null&&s.message.includes("Error:")?u.response.data.message.replace("Error: ",""):(i=(e=u.response)==null?void 0:e.data)==null?void 0:i.message),setTimeout(()=>d.push("/"),3e3)}finally{U.value=!1}});const V=async()=>{var r,s;try{let e=_.value.replace(/\D/g,"");e.startsWith("0")&&(e="38"+e),e.startsWith("380")&&(e=e.replace(/^380/,"380"));const i=await w.auth.updateUser({name:v.value,surname:h.value,phone:e,picture:x.value});if([200,201].includes(i.status)){const u=k.loadUserData();u.user=i.data[0],k.saveUserData(u),m.value=!0,g.value=!1}else a.value="Не вдалося оновити дані користувача.",setTimeout(()=>d.push("/"),3e3)}catch(e){a.value="Помилка оновлення: "+(((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Невідома помилка."),setTimeout(()=>d.push("/"),3e3)}};return(r,s)=>(c(),n("div",null,[W,U.value?(c(),n("p",j,"Аутентифікація...")):p("",!0),a.value?(c(),n("p",C,E(a.value),1)):p("",!0),m.value&&!a.value?(c(),n("p",L," Вітаємо аутентифікація пройшла успішно! ")):p("",!0),g.value?(c(),n("div",$,[q,t("form",{class:"w-1/2 mx-auto mb-2",onSubmit:R(V,["prevent"])},[t("div",z,[F,f(t("input",{id:"name","onUpdate:modelValue":s[0]||(s[0]=e=>v.value=e),type:"text",class:"border rounded px-2 py-1 w-full"},null,512),[[y,v.value]])]),t("div",G,[H,f(t("input",{id:"surname","onUpdate:modelValue":s[1]||(s[1]=e=>h.value=e),type:"text",class:"border rounded px-2 py-1 w-full"},null,512),[[y,h.value]])]),t("div",I,[J,f(t("input",{id:"phone","onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e),type:"text",class:"border rounded px-2 py-1 w-full"},null,512),[[y,_.value]])]),t("div",K,[O,f(t("input",{id:"picture","onUpdate:modelValue":s[3]||(s[3]=e=>x.value=e),type:"text",class:"border rounded px-2 py-1 w-full"},null,512),[[y,x.value]])]),P],32)])):p("",!0),!U.value&&(a.value||m.value)?(c(),n("p",Q,Y)):p("",!0)]))}};export{te as default};
