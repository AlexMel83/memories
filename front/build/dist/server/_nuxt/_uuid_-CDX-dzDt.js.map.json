{"file":"_uuid_-CDX-dzDt.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEkB,iBAAe;AAChB,eAAa;AAC9B,UAAM,WAAW,IAAI,KAAK;AAC1B,UAAM,UAAU,IAAI,KAAK;AACV,cAAY;AAC3B,UAAM,UAAU,IAAI,IAAI;AACV,aAAW;AACzB,UAAM,QAAQ,IAAI,IAAI;AAEtB,UAAM,OAAO,IAAI,EAAE;AACnB,UAAM,UAAU,IAAI,EAAE;AACtB,UAAM,QAAQ,IAAI,EAAE;AACpB,UAAM,UAAU,IAAI,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../pages/activate/[uuid].vue"],"sourcesContent":["<template>\n  <div>\n    <h1 class=\"text-center text-2xl mt-2\">Активація аккаунту</h1>\n    <p v-if=\"loading\" class=\"text-center mt-1 mb-2\">Активація...</p>\n    <p v-if=\"error\" class=\"text-red-500 text-center mt-1 mb-2\">\n      {{ error }}\n    </p>\n    <p v-if=\"success && !error\" class=\"mt-1 mb-2 text-green-500 text-center\">\n      Вітаємо Ваш аккаунт успішно активовано!\n    </p>\n\n    <div v-if=\"editMode\" class=\"mt-4\">\n      <h2 class=\"text-center text-xl mb-2\">\n        Заповніть дані для завершення реєстрації\n      </h2>\n      <form class=\"w-1/2 mx-auto mb-2\" @submit.prevent=\"updateUser\">\n        <div class=\"mb-2\">\n          <label for=\"name\" class=\"block\">Ім'я:</label>\n          <input\n            id=\"name\"\n            v-model=\"name\"\n            type=\"text\"\n            class=\"border rounded px-2 py-1 w-full\"\n          />\n        </div>\n        <div class=\"mb-2\">\n          <label for=\"surname\" class=\"block\">Прізвище:</label>\n          <input\n            id=\"surname\"\n            v-model=\"surname\"\n            type=\"text\"\n            class=\"border rounded px-2 py-1 w-full\"\n          />\n        </div>\n        <div class=\"mb-2\">\n          <label for=\"phone\" class=\"block\">Телефон:</label>\n          <input\n            id=\"phone\"\n            v-model=\"phone\"\n            type=\"text\"\n            class=\"border rounded px-2 py-1 w-full\"\n          />\n        </div>\n        <div class=\"mb-2\">\n          <label for=\"picture\" class=\"block\">Фото профілю (URL):</label>\n          <input\n            id=\"picture\"\n            v-model=\"picture\"\n            type=\"text\"\n            class=\"border rounded px-2 py-1 w-full\"\n          />\n        </div>\n        <button\n          type=\"submit\"\n          class=\"bg-blue-500 text-white px-4 py-2 rounded mt-2\"\n        >\n          Зберегти\n        </button>\n      </form>\n    </div>\n    <p v-if=\"!loading && (error || success)\" class=\"text-center\">\n      <a href=\"/\">Повернутися на головну</a>\n    </p>\n  </div>\n</template>\n\n<script setup>\nimport { useAuthStore } from '~/stores/auth.store';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ref, onMounted } from 'vue';\nimport { useNuxtApp } from '#app';\n\nconst authStore = useAuthStore();\nconst { $api } = useNuxtApp();\nconst editMode = ref(false);\nconst success = ref(false);\nconst router = useRouter();\nconst loading = ref(true);\nconst route = useRoute();\nconst error = ref(null);\n\nconst name = ref('');\nconst surname = ref('');\nconst phone = ref('');\nconst picture = ref('');\n\nonMounted(async () => {\n  try {\n    const uuid = route.params.uuid;\n    const response = await $api.auth.activate(uuid);\n    if (\n      response &&\n      [200, 201].includes(response.status) &&\n      ![400, 401, 403, 404, 500].includes(response.data.status)\n    ) {\n      const data = response.data;\n      authStore.saveUserData(data);\n      success.value = true;\n      if (!data.user.name || !data.user.surname || !data.user.phone) {\n        name.value = data.user.name || '';\n        surname.value = data.user.surname || '';\n        phone.value = data.user.phone || '';\n        picture.value = data.user.picture || '';\n        editMode.value = true;\n      }\n    } else {\n      error.value = 'Помилка активації.';\n      setTimeout(() => router.push('/'), 3000);\n    }\n  } catch (err) {\n    error.value =\n      'Помилка активації: ' +\n      (err.response?.data?.message.includes('Error:')\n        ? err.response.data.message.replace('Error: ', '')\n        : err.response?.data?.message);\n    setTimeout(() => router.push('/'), 3000);\n  } finally {\n    loading.value = false;\n  }\n});\n\nconst updateUser = async () => {\n  try {\n    let cleaned = phone.value.replace(/\\D/g, '');\n    if (cleaned.startsWith('0')) {\n      cleaned = '38' + cleaned;\n    }\n    if (cleaned.startsWith('380')) {\n      cleaned = cleaned.replace(/^380/, '380');\n    }\n    const response = await $api.auth.updateUser({\n      name: name.value,\n      surname: surname.value,\n      phone: cleaned,\n      picture: picture.value,\n    });\n    if ([200, 201].includes(response.status)) {\n      const userData = authStore.loadUserData();\n      userData.user = response.data[0];\n      authStore.saveUserData(userData);\n      success.value = true;\n      editMode.value = false;\n    } else {\n      error.value = 'Не вдалося оновити дані користувача.';\n      setTimeout(() => router.push('/'), 3000);\n    }\n  } catch (err) {\n    error.value =\n      'Помилка оновлення: ' +\n      (err.response?.data?.message || 'Невідома помилка.');\n    setTimeout(() => router.push('/'), 3000);\n  }\n};\n</script>\n"],"version":3}